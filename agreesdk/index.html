<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>赞同移动产品 | AgreeSDK开发文档</title>
    <meta name="description" content="赞同移动产品">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.41207d2c.css" as="style"><link rel="preload" href="/assets/js/app.90eb0a38.js" as="script"><link rel="preload" href="/assets/js/9.ebc821e7.js" as="script"><link rel="prefetch" href="/assets/js/5.4f9f37ff.js"><link rel="prefetch" href="/assets/js/1.4c3f9f17.js"><link rel="prefetch" href="/assets/js/2.10165007.js"><link rel="prefetch" href="/assets/js/3.9d1833d6.js"><link rel="prefetch" href="/assets/js/4.e048d8b2.js"><link rel="prefetch" href="/assets/js/6.c91f434e.js"><link rel="prefetch" href="/assets/js/7.bfa7216c.js"><link rel="prefetch" href="/assets/js/8.0f204b2e.js"><link rel="prefetch" href="/assets/js/10.d6db8c7a.js"><link rel="prefetch" href="/assets/js/11.a9dc42e7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41207d2c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      赞同移动产品
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/agreesdk/" class="nav-link router-link-exact-active router-link-active">AgreeSDK</a></div><div class="nav-item"><a href="/emm/" class="nav-link">AEMMSDK</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/agreesdk/" class="nav-link router-link-exact-active router-link-active">AgreeSDK</a></div><div class="nav-item"><a href="/emm/" class="nav-link">AEMMSDK</a></div><!----></nav><ul class="sidebar-links"><li><a href="/agreesdk/" class="active sidebar-link">AgreeSDK开发文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/agreesdk/#agreesdk-是什么？" class="sidebar-link">AgreeSDK 是什么？</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#如何使用？" class="sidebar-link">如何使用？</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#插件开发" class="sidebar-link">插件开发</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#资源更新" class="sidebar-link">资源更新</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#设备管理" class="sidebar-link">设备管理</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#沉浸式状态栏设置" class="sidebar-link">沉浸式状态栏设置</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#开机自启动设置" class="sidebar-link">开机自启动设置</a></li><li class="sidebar-sub-header"><a href="/agreesdk/#应用更新" class="sidebar-link">应用更新</a></li></ul></li><li><a href="/agreesdk/api.html" class="sidebar-link">API文档</a></li><li><a href="/agreesdk/version.html" class="sidebar-link">更新日志</a></li><li><a href="/agreesdk/product.html" class="sidebar-link">产品下载</a></li></ul></div><div class="page"><div class="content"><h1 id="agreesdk开发文档"><a href="#agreesdk开发文档" aria-hidden="true" class="header-anchor">#</a> AgreeSDK开发文档</h1><h2 id="agreesdk-是什么？"><a href="#agreesdk-是什么？" aria-hidden="true" class="header-anchor">#</a> AgreeSDK 是什么？</h2><p>AgreeSDK 允许您使用标准的 Web 技术 - HTML5、CSS3 和 JavaScript 进行跨平台开发，JS SDK 参考 Apache 开源框架 <a href="http://cordova.apache.org/" target="_blank" rel="noopener noreferrer">Cordova<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行改造优化，提供了一套统一的 API 可以方便的调用原生 API。应用程序在针对每个平台的基座中执行，并依靠符合标准的 API 绑定来访问每个设备的功能，例如设备信息、摄像头，文件系统等。</p><p>不同平台提供标准的 JS SDK 和原生壳，业务逻辑采用 web 技术开发的开发模式可以更好的实现多端复用同一套代码。面向不同系统的原生壳，根据宿主系统的特性封装不同功能的原生插件（例如调用定位、访问相册），并根据系统版本和功能制定插件版本。</p><p>通过一套统一标准的 JS 层与 Native 层通信的插件通信机制，可以很方便的进行原生插件拓展，兼容现有的其他原生开发及 web 开发使用的技术方案，可以满足不同的业务需求，同时很好的发挥了不同平台的优势。</p><p><img src="http://p6n8dwts1.bkt.clouddn.com/agreesdk_design.png" alt="系统架构"></p><p>为了满足不同的业务需求，平台提供了三大类别插件：设备组件、业务组件、三方组件。设备插件主要提供调用设备原生系统的 API，在此基础上业务层只需要调用标准的 API 即可实现底层提供的系统原生功能；业务插件是客户端基本默认插件，通过配置文件设置简化了开发流程，提供基本的开发时调试和运行时安全通信、更新、监控等基本功能保障；三方插件是可选的，用以补充某些业务场景下的功能需求，如移动背夹、语音识别、地图定位等。</p><p><img src="http://p6n8dwts1.bkt.clouddn.com/agreesdk_plugin.png" alt="插件分类"></p><p>AgreeSDK 参考 Cordova 开源框架做了很多优化和改造，提供了插件拓展的能力，同时也封装了一些常用的组件，简化了开发人员的工作流程，让新手上手起来更容易。Cordova 开发通常需要本地配置开发环境，原生插件版本控制以及定制化对于不熟悉原生 App 开发的开发人员来说，有不小的开发成本。AgreeSDK 对开发阶段及打包发布都提供一些很实用的开发管理工具。AgreeSDK 满足只需要简单修改就可以兼容使用 Cordova 现有插件，但是为了更加统一标准的规范，建议遵循 AgreeSDK 提供的插件开发规范进行编写插件。</p><h2 id="如何使用？"><a href="#如何使用？" aria-hidden="true" class="header-anchor">#</a> 如何使用？</h2><p>AgreeSDK 新版本简化了 Cordova 繁琐的配置和调试方式，从底层上剔除了 Cordova 过时的架构设计，JS 部分采用 ES6 开发，支持同步和异步调用两种模式，原生层增加更多工具类对插件进行拓展，提供原生插件拓展和原生 UI 的快速开发。</p><p>应用层直接在页面里面通过 <code>script</code> 标签引入，如</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;AgreeSDK.js&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>或者作为 Vue.js 拓展插件使用，在 Vue.js 开发工程引入：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> AgreeSDK <span class="token keyword">from</span> <span class="token string">&quot;./AgreeSDK&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>AgreeSDK<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  debug<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当作为 Vue 插件使用的时候，可以通过配置参数对基座内部进行全局控制。字段说明：</p><ul><li><strong>debug:</strong> 是否打开应用内置控制控制台。需要说明的是 manifest.json 配置级别高于代码中的配置，只有当 manifest.json 里面 debugable 字段设置为 true 时，这里的 debug 设置才会生效。</li></ul><p>命名空间为 <code>AgreeSDK.moduleName.methodName</code>，在 Vue 组件里面也可以通过 <code>this.$sdk.moduleName.methodName</code> 调用。</p><p>JS 层调用参考 doc 文档，原生插件开发及配置见<a href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91">插件开发</a>。</p><h2 id="插件开发"><a href="#插件开发" aria-hidden="true" class="header-anchor">#</a> 插件开发</h2><p>以下从技术维度简要说明插件开发的规范和技术细节，具体代码可以参考 Android 开发工程例子。</p><h3 id="开发工程结构说明"><a href="#开发工程结构说明" aria-hidden="true" class="header-anchor">#</a> 开发工程结构说明</h3><ul><li>app：开发主 Module
<ul><li>libs：依赖库(aar、jar、so)</li><li>src/main
<ul><li>assets
<ul><li>res：AgreeSDKCore.aar 依赖的资源文件， 不建议修改(如：图片、语言)；</li><li>data：AgreeSDKCore 默认配置，开发时可以  根据实际情况进行修改；</li><li>www：打包所需的交易资源和交易配置文件 manifest.json</li></ul></li><li>java：插件开发拓展原生代码；</li><li>res：图标、启动页、应用名称等基本配置内容；</li><li>AndroidManifest.xml：权限、原生 Acticity、Service 配置。</li></ul></li><li>build.gradle：gradle 打包脚本配置文件</li></ul></li></ul><h3 id="js-层调用-java-层"><a href="#js-层调用-java-层" aria-hidden="true" class="header-anchor">#</a> JS 层调用 Java 层</h3><p>JS 层调用 Java 层通过类似于前端调用服务  的形式实现，通过 AgreeSDK 提供的桥梁，我们可以使用 AgreeSDK.bridge.execSync 和 AgreeSDK.bridge.exec 实现调用。</p><h4 id="js-部分"><a href="#js-部分" aria-hidden="true" class="header-anchor">#</a> JS 部分</h4><h5 id="同步调用"><a href="#同步调用" aria-hidden="true" class="header-anchor">#</a> 同步调用:</h5><div class="language-js extra-class"><pre class="language-js"><code>Object AgreeSDK<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> action<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>service：调用插件方法对于的插件类别名</li><li>action：调用插件方法的名称</li><li>args：调用插件方法使用的参数列表</li></ul><h5 id="异步调用"><a href="#异步调用" aria-hidden="true" class="header-anchor">#</a> 异步调用:</h5><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">void</span> AgreeSDK<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>
  completeCallback <span class="token comment">/* 成功或失败的回调函数 */</span><span class="token punctuation">,</span>
  successCallback <span class="token comment">/* 成功的回调函数 */</span><span class="token punctuation">,</span>
  failCallback <span class="token comment">/* 失败的回调函数 */</span><span class="token punctuation">,</span>
  service <span class="token comment">/* 调用插件方法对于的插件类别名 */</span><span class="token punctuation">,</span>
  action <span class="token comment">/* 调用插件方法的名称 */</span><span class="token punctuation">,</span>
  args <span class="token comment">/* 调用插件方法使用的参数列表 */</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>completeCallback：成功或失败的回调函数</li><li>successCallback：成功的回调函数</li><li>failCallback：失败的回调函数</li><li>service：调用插件方法对于的插件类别名</li><li>action：调用插件方法的名称</li><li>args：调用插件方法使用的参数列表</li></ul><h4 id="android-部分"><a href="#android-部分" aria-hidden="true" class="header-anchor">#</a> Android 部分</h4><h5 id="配置文件-assets-data-config-xml："><a href="#配置文件-assets-data-config-xml：" aria-hidden="true" class="header-anchor">#</a> 配置文件 assets/data/config.xml：</h5><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>widget</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--测试插件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.com.agree.abc.sdk.app.plugins.TestFeatureImpl<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>widget</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="同步调用-2"><a href="#同步调用-2" aria-hidden="true" class="header-anchor">#</a> 同步调用:</h5><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
  * 同步调用
  *
  * @param webView
  * @param array
  * @param callbackContext
  * @return
  */</span>
<span class="token annotation punctuation">@JavaScriptApi</span>
<span class="token keyword">public</span> String <span class="token function">syncTest</span><span class="token punctuation">(</span>AgreeSDKWebView webView<span class="token punctuation">,</span> JSONArray array<span class="token punctuation">,</span> CallbackContext callbackContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;syncTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sync function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> callbackContext<span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="异步调用-2"><a href="#异步调用-2" aria-hidden="true" class="header-anchor">#</a> 异步调用:</h5><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
  * 异步调用
  *
  * @param webView
  * @param array
  * @param callbackContext
  * @return
  */</span>
<span class="token annotation punctuation">@JavaScriptApi</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncTest</span><span class="token punctuation">(</span>AgreeSDKWebView webView<span class="token punctuation">,</span> JSONArray array<span class="token punctuation">,</span> CallbackContext callbackContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;asyncTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;async function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    callbackContext<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="java-层调用-js-层"><a href="#java-层调用-js-层" aria-hidden="true" class="header-anchor">#</a> Java 层调用 JS 层</h3><p>Android 原生提供了执行 JavaScript 的 API，在插件类里面可以通过 <code>JSUtil.evaluateJavascript(AgreeSDKWebView webView, String js)</code> 或 <code>webView.evaluateJavascript(String js)</code>调用。</p><p>JS 层如果想接受原生层主动发送的消息，需要通过事件监听的方式去执行，例如：</p><div class="language-java extra-class"><pre class="language-java"><code>webView<span class="token punctuation">.</span><span class="token function">setWebViewClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPageFinished</span><span class="token punctuation">(</span>WebView view<span class="token punctuation">,</span> String url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPageFinished</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

        JSUtil<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token string">&quot;AgreeSDK.bridge.fireDocumentEvent('titleUpdate', '&quot;</span> <span class="token operator">+</span> view<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;')&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JS 层监听原生层的消息：</p><div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;titleUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;title: &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件初始化及其生命周期"><a href="#插件初始化及其生命周期" aria-hidden="true" class="header-anchor">#</a> 插件初始化及其生命周期</h3><p>一个插件对象的一个实例是为每个 WebView 的生命创建的，插件不会被实例化，直到它们被 JavaScript 的调用首次引用为止，除非在 config.xml 中将具有 onload name 属性的<code>&lt;param&gt;</code>设置为“true”。</p><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.com.agree.abc.sdk.app.plugins.TestFeatureImpl<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>插件使用 initialize 初始化启动：</p><div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> AgreeSDKWebView webView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> webView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 自定义逻辑</span>
<span class="token punctuation">}</span>
</code></pre></div><p>插件还可以访问 Android 生命周期事件，并可以通过扩展所提供的方法（<code>onResume</code>，<code>onDestroy</code>等）来处理它们。具有长时间运行请求的插件，媒体播放，侦听器或内部状态等背景活动应实现 <code>onReset()</code> 方法。 当 WebView 导航到新页面或刷新时，它会执行，这会重新加载 JavaScript。</p><h3 id="异步费时操作"><a href="#异步费时操作" aria-hidden="true" class="header-anchor">#</a> 异步费时操作</h3><p>AgreeSDK Android 插件默认是在 WebView 界面的主线程中运行，而 Cordova 插件是在 WebCore 线程上运行，所以 AgreeSDK 插件执行原生 UI 更新不需要写在<code>runOnUiThread</code> 中，这极大的简化了调用流程，同时也是上述支持同步的根本原因。如果不需要在 UI 线程上运行也不希望阻止 WebCore 线程，则可以使用<code>webview.getActivity().getThreadPool()</code> 获得的 AgreeSDK <code>ExecutorService</code> 执行代码，也可以使用 Android 原生的异步编程的方法，如 Handler、AsyncTask 等。</p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">AsyncTask</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Void<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> isSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> String <span class="token function">doInBackground</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> strings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 子线程处理费事操作</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPostExecute</span><span class="token punctuation">(</span>String result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 操作结束主线程</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="资源更新"><a href="#资源更新" aria-hidden="true" class="header-anchor">#</a> 资源更新</h2><p>当服务器部署资源文件有部分文件改动时，客户端会将服务器改动的文件差量下载更新到本地，而之前服务器其他未改动的文件则不会下载。</p><p>差量文件更新是依据全局资源地图 GRM（Global Resource Map）下载的。服务器端 ABS workspace 下会有一个“.grm” 文件夹， HEAD 文件，在“.grm”文件夹中，存在一个名为 HEAD 的文件，里面存放的是当前 GRM 版本。存在一个名为 MAP+Version（version 是一串 MD5 加密后的字符串）的文件，里面内容是当前 Workspace 下的文件列表。文件中每一行内容格式是[文件路径名+“:”+MD5 加密后的字符串]。</p><h3 id="更新逻辑流程"><a href="#更新逻辑流程" aria-hidden="true" class="header-anchor">#</a> 更新逻辑流程</h3><h4 id="初始化本地-grm"><a href="#初始化本地-grm" aria-hidden="true" class="header-anchor">#</a> 初始化本地 GRM</h4><p>首先检测本地 GRM 是否存在，如果不存在，说明是第一次更新资源文件，需要从服务器端下载 GRM。</p><h4 id="获取远程-grm-版本号"><a href="#获取远程-grm-版本号" aria-hidden="true" class="header-anchor">#</a> 获取远程 GRM 版本号</h4><p>通过 Http 请求获取 GRM 的版本号（获取的版本号是一个 MD5 加密后的字符串），将获取到的版本与当前本地 GRM 版本进行对比，如果两个版本不一致，则需要从服务器更新 GRM，并将新的 GRM 版本写入到 HEAD 文件中，来替换原来的本地 GRM 版本。如果之前本地不存在 GRM 文件夹，则需要下载 GRM。</p><h4 id="读取本地-map-文件"><a href="#读取本地-map-文件" aria-hidden="true" class="header-anchor">#</a> 读取本地 MAP 文件</h4><p>步骤 1 和 2 是对 GRM 的检测更新。只有在本地 GRM 存在的情况下，才能读取本地 MAP 文件。读取 MAP 文件后会得到资源文件的每一个文件的路径和 MD5 加密的标记值。</p><h4 id="对比标记值"><a href="#对比标记值" aria-hidden="true" class="header-anchor">#</a> 对比标记值</h4><p>遍历本地 workspace 下的文件，并给每个文件添加 MD5 加密后的标记文件，将本地 MD5 加密后的标记与 MAP 文件中的标记进行对比，若不同，则表示需要更新资源，否则表示不需要更新资源。</p><h3 id="配置使用说明"><a href="#配置使用说明" aria-hidden="true" class="header-anchor">#</a> 配置使用说明</h3><p>在 ABS workspace 下新建 app/www 目录，将前端开发打包完成的 dist 文件夹下的文件放 ABS workspace/app/www 目录下，修改客户端工程 app/src/main/assets/www/manifest.json 配置文件中 abs 字段 host 为实际 IP , 修改配置如下：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;abs&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;192.168.89.173&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;httpPort&quot;</span><span class="token punctuation">:</span> <span class="token number">50002</span><span class="token punctuation">,</span>
    <span class="token string">&quot;httpsPort&quot;</span><span class="token punctuation">:</span> <span class="token number">50004</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apkUpdate&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">&quot;resourceUpdate&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;remoteProjectPath&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/app&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="资源热更新"><a href="#资源热更新" aria-hidden="true" class="header-anchor">#</a> 资源热更新</h3><p>服务端文件变动会推送给客户端，客户端新增 AgreeSDK.app.resourceUpdate 方法。</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">&quot;ws://192.168.187.124:50010/ws/broadcast&quot;</span><span class="token punctuation">,</span>
  oid<span class="token punctuation">:</span> <span class="token string">&quot;agree_oid&quot;</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onOpen&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> response<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;resourceUpdate&quot;</span><span class="token punctuation">:</span>
        <span class="token comment">// 建议替换为 AUI 提示框</span>
        <span class="token keyword">let</span> isUpdate <span class="token operator">=</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;有新的资源需要更新，是否进行更新！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 资源更新逻辑</span>
          AgreeSDK<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">resourceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            success<span class="token punctuation">:</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              AgreeSDK<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">restartApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            fail<span class="token punctuation">:</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              AgreeSDK<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onClose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onError&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="设备管理"><a href="#设备管理" aria-hidden="true" class="header-anchor">#</a> 设备管理</h2><p>AgreeSDK 设备管理模块提供如下功能：清点设备、系统配置管理、收回设备、远程擦除、远程检查或控制。对于不同权限级别的用户提供了相应的权限管理。通过获得手机超级管理员权限，用户授权自己的应用设备管理权限后，可以在代码中修改很多系统设置，例如屏幕锁定（可实现 Home 键禁用）。</p><h3 id="设置设备拥有者权限"><a href="#设置设备拥有者权限" aria-hidden="true" class="header-anchor">#</a> 设置设备拥有者权限</h3><p>为了在调用相关 API 时不再提示权限信息，在此之前需要先获取 DeviceOwner 权限。设置 DeviceOwner 权限是有限制的，需要手机账号（acount）为 0 .</p><p>用命令查看手机的帐号：</p><div class="language- extra-class"><pre class="language-text"><code>adb shell dumpsys account
</code></pre></div><p>用 adb shell pm hide 来禁用上面提供的账号：</p><div class="language- extra-class"><pre class="language-text"><code>adb shell pm hide AccountType
</code></pre></div><p>注：这里 AccountType 为账户 Type 值。</p><p>获取 DeviceOwner 权限的方法有多种，这里以执行 ADB 命令进行说明，在命令行执行 ADB 命令:</p><div class="language- extra-class"><pre class="language-text"><code>adb shell dpm set-device-owner packagename/cn.com.agree.abc.sdk.core.security.SDKDeviceAdminReceiver
</code></pre></div><p>注：这里 packagename 为当前应用的包名。</p><h3 id="调用设备管理-api"><a href="#调用设备管理-api" aria-hidden="true" class="header-anchor">#</a> 调用设备管理 API</h3><p>JS 层在调用相关设备操作时，首先要通过 API 获取激活设备管理员，如下：</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">activeAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用该方法后应用会跳转到系统激活设备管理员界面，点击激活即可。</p><p>判断是否激活设备管理员，可以使用下述方法进行测试：</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">isAdminActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>锁定应用（即屏蔽 Home 键），通过调用 JS 方法来锁定应用</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">startLockTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>退出屏幕锁定需要执行：</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">stopLockTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="沉浸式状态栏设置"><a href="#沉浸式状态栏设置" aria-hidden="true" class="header-anchor">#</a> 沉浸式状态栏设置</h2><p>应用可视区域到系统状态栏下透明显示效果，如下图所示：</p><p><img src="http://p6n8dwts1.bkt.clouddn.com/statusbar.png" alt></p><p>此模式下应用占用全屏区域，而系统状态栏会拦截用户操作事件，此时需要预留出系统状态栏高度。</p><h3 id="第一步：设置配置文件"><a href="#第一步：设置配置文件" aria-hidden="true" class="header-anchor">#</a> 第一步：设置配置文件</h3><p>应用默认不使用沉浸式状态栏样式，需要进行如下配置开启：</p><p>打开应用的 manifest.json 文件，在 statusbar 下添加 immersed 节点并设置值为 true。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;statusbar&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;immersed&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="第二步：使用-api-获取状态栏高度，动态调整页面元素内边距高度"><a href="#第二步：使用-api-获取状态栏高度，动态调整页面元素内边距高度" aria-hidden="true" class="header-anchor">#</a> 第二步：使用 API 获取状态栏高度，动态调整页面元素内边距高度</h3><p>可以通过 AgreeSDK.screen.statusBarHeight 获取状态栏的高度。</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>头部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 设置状态栏</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取状态栏高度</span>
  <span class="token keyword">let</span> statusBarHeight <span class="token operator">=</span> AgreeSDK<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">;</span>
  <span class="token comment">// 设置相关高度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>header<span class="token punctuation">.</span>style<span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> statusBarHeight <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>paddingTop <span class="token operator">=</span> <span class="token number">50</span> <span class="token operator">+</span> statusBarHeight <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="其他设置"><a href="#其他设置" aria-hidden="true" class="header-anchor">#</a> 其他设置</h3><h4 id="设置状态栏的字体风格"><a href="#设置状态栏的字体风格" aria-hidden="true" class="header-anchor">#</a> 设置状态栏的字体风格</h4><p>设置配置文件启用沉浸式状态栏，然后添加以下配置。dark为深色，light为亮色，其实就是黑色和白色。此设置只有在android6.0及以上系统中可用，部分5.0的厂商定制设备可用。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;statusbar&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;immersed&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;dark&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="js调用修改状态栏"><a href="#js调用修改状态栏" aria-hidden="true" class="header-anchor">#</a> js调用修改状态栏</h4><p>在不同的页面中可以修改状态栏背景颜色和字体风格，代码如下：</p><div class="language-js extra-class"><pre class="language-js"><code>AgreeSDK<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">setStatusBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   style<span class="token punctuation">:</span><span class="token string">'dark'</span><span class="token punctuation">,</span>
   backgroundColor<span class="token punctuation">:</span><span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其中style和上述设置状态栏的字体风格一样。backgroundColor在非沉浸式状态栏下可用，系统要求在android5.0以上，部分android5.0的厂商定制设备不可用。</p><h2 id="开机自启动设置"><a href="#开机自启动设置" aria-hidden="true" class="header-anchor">#</a> 开机自启动设置</h2><p>开机自启动设置可以让应用 app 在开机后自动打开，使用很简单，只需要遵循以下两个步骤：</p><h3 id="第一步：设置配置文件-2"><a href="#第一步：设置配置文件-2" aria-hidden="true" class="header-anchor">#</a> 第一步：设置配置文件</h3><p>打开应用的 manifest.json 文件，设置&quot;autoStart&quot;节点为 true 或 false 即可。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;autoStart&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="第二步：打开app"><a href="#第二步：打开app" aria-hidden="true" class="header-anchor">#</a> 第二步：打开app</h3><h3 id="第三步：授予app开机自启动权限"><a href="#第三步：授予app开机自启动权限" aria-hidden="true" class="header-anchor">#</a> 第三步：授予app开机自启动权限</h3><p>在手机或 pad 上，打开设置应用，找到权限管理或开机自启动管理，由于设备的不同导致设置的开机自启动权限授予的入口不同，需要耐心找到开机自启动权限打开的入口，以下两个示例是两个不同的设备的两个不同的入口。</p><ul><li>这个入口直接在设置界面上</li></ul><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fr7geztee7j31hc0xcdjy.jpg" alt></p><ul><li>这个入口是在设置的权限管理中</li></ul><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fr7ggmi270j31kw0zkjve.jpg" alt></p><p>如果设置中没有授予权限的入口，请直接运行测试，如果找不到入口或者设置了不生效，请联系我们。</p><h2 id="应用更新"><a href="#应用更新" aria-hidden="true" class="header-anchor">#</a> 应用更新</h2><p>在应用开发阶段我们使用调试基座扫描调试开发，基础开发完成后可以借助于赞同移动应用打包平台进行在线打包，也可以通过本地工程使用脚本离线打包。开发完成后可以将安装包上传到企业自己的应用商店，也可以使用赞同的应用商店和 EMM 管理平台，实现对安装包的版本管理和发布。
应用内集成了两个基本功能：资源更新、基座更新。资源更新需要通过 abs 下发，当服务器部署资源文件有部分文件改动时，客户端会将服务器改动的文件差量下载更新到本地，而之前服务器其他未改动的文件则不会下载。差量文件更新是依据全局资源地图 GRM（Global Resource Map）下载的。服务器端 ABS workspace 下会有一个“.grm” 文件夹， HEAD 文件，在“.grm”文件夹中，存在一个名为 HEAD 的文件，里面存放的是当前 GRM 版本。存在一个名为 MAP+Version（version 是一串 MD5 加密后的字符串）的文件，里面内容是当前 Workspace 下的文件列表。
作为独立应用安装时，客户端基座每次启动的时候都会检查服务端的版本信息，当服务端修改基座更新的配置后，客户端会提示基座更新的消息。应用更新是根据本地app的版本号和服务端app的版本号来判定更新的。这两个版本号中，任何一个检查到线上版本大于本地版本，都会提示更新。</p><h3 id="使用步骤"><a href="#使用步骤" aria-hidden="true" class="header-anchor">#</a> 使用步骤</h3><ol><li><p>打开应用的manifest.json文件，在preference-&gt;abs中配置apkUpdate为true，apkUpdateUrl地址为应用最新版本的信息文件或者接口。</p><div class="language-xml extra-class"><pre class="language-xml"><code>&quot;preference&quot;: {
    /* ABS 基本配置 */
    &quot;abs&quot;: {
      &quot;host&quot;: &quot;192.9.63.248&quot;,
      &quot;httpPort&quot;: 50002,
      &quot;httpsPort&quot;: 50004,
      &quot;apkUpdate&quot;: true,
      &quot;resourceUpdate&quot;: false,
      &quot;apkUpdateUrl&quot;: &quot;https://www.agree.com/update.txt&quot;
    }
}
</code></pre></div></li><li><p>编写接口文件update.txt，并遵循以下格式。</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;versionName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v1.0.1&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;versionCode&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
   <span class="token property">&quot;apkUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://raw.githubusercontent.com/WVector/AppUpdateDemo/master/apk/sample-debug.apk&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;updateLog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1，添加删除信用卡接口。\r\n2，添加vip认证。\r\n3，区分自定义消费，一个小时不限制。\r\n4，添加放弃任务接口，小时内不生成。\r\n5，消费任务手动生成。&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;apkSize&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5M&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;constraint&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>其中versionName代表版本名称，versionCode代表版本号，apkUrl代表更新的apk的下载地址，updateLog代表更新日志，apkSize代表apk的大小，constraint代表是否强制更新。</p></li></ol><p>打开应用即可测试应用更新。
<img src="https://ws4.sinaimg.cn/large/006tKfTcly1ftju0ecz06j31hc0xcwz7.jpg" alt></p></div><div class="content edit-link"><!----><!----></div><div class="content page-nav"><p class="inner"><!----><span class="next"><a href="/agreesdk/api.html">
          API文档
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/9.ebc821e7.js" defer></script><script src="/assets/js/app.90eb0a38.js" defer></script>
  </body>
</html>
